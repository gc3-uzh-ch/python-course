\documentclass[english,serif,mathserif,xcolor=pdftex,dvipsnames,table]{beamer}
\usetheme[informal]{gc3}
\usepackage{gc3}

\title[Testing]{%
  Testing your code
}
\author[GC3]{%
  GC3: Grid Computing Competence Center, \\
  University of Zurich
}
\date{Mar.~19--20, 2014}

\begin{document}

% title frame
\maketitle


\begin{frame}
  \frametitle{Testing is \textbf{not} a waste of time.}
  A test is a piece of code that, when executed, check if the code you
  wrote behave as expected.

  \+
  Writing (and running often) tests\ldots
  \begin{itemize}
  \item helps you to easily find bugs.
  \item forces you to slow down and think.
  \item reduces the cost of change.
  \item reduces fear.
  \end{itemize}

  \+ \textbf{Test Driven Development:} writing tests \textit{before}
  writing the code helps you to write \textbf{better code.}
\end{frame}


\begin{frame}
  \frametitle{Different kind of tests}

  Each test will check that a component of your code behaves in a
  specific way when you feed it with a specific input.

  \+
  There are two kind of tests:
  \begin{itemize}
  \item Specific functions or class methods
    \begin{itemize}
    \item \textbf{unit tests}
    \end{itemize}
  \item bigger part of the program, or maybe the whole program.
    \begin{itemize}
    \item \textbf{functional tests}
    \end{itemize}
  \end{itemize}

  \+
  \pause
  yes, it's better to have both :-)
\end{frame}


\begin{frame}[fragile]
  \frametitle{Doctest (1/3)}

  The \lstinline|doctest| module searches for text that looks like
  interactive Python sessions in \textit{docstrings}, and then
  executes them to verify that they work exactly as shown.

  \+
  Combines \textit{documentation} and \textit{tests}
  \begin{lstlisting}
  def square(self, n):
    """
    This function compute the square of a number.

      >>> square(2)
      4
      >>> square(-2)
      4
    """
    return n*n
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Doctest (2/3)}
  \begin{columns}[t]
    \begin{column}{0.6\textwidth}
  \begin{lstlisting}
def square(x):
    """
    ~\HL{This function compute}~
    ~\HL{the square of a number.}~

      >>> square(2)
      4
    """
  \end{lstlisting}
\end{column}
\begin{column}{0.4\textwidth}
  Line \textbf{not} starting with \texttt{>>>} and \textbf{not}
  following any line starting with \texttt{>>>}. It's documentation.
\end{column}
\end{columns}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Doctest (2/3)}
\begin{columns}[t]
  \begin{column}{0.6\textwidth}
  \begin{lstlisting}
def square(x):
    """
    This function compute
    the square of a number.

      ~\HL{>>> square(2)}~
      4
    """
  \end{lstlisting}
\end{column}
\begin{column}{0.4\textwidth}
  It starts with a \texttt{>>>}, so it's python code: the line will be
  executed inside a python shell.
\end{column}
\end{columns}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Doctest (2/3)}
\begin{columns}[t]
  \begin{column}{0.6\textwidth}
  \begin{lstlisting}
def square(x):
    """
    This function compute
    the square of a number.

      >>> square(2)
      ~\HL{4}~
    """
  \end{lstlisting}
\end{column}
\begin{column}{0.4\textwidth}
  It follows a line beginning with \texttt{>>>} \textbf{and} is
  indented in the same way: it's the output of the previous python
  statement.
\end{column}
\end{columns}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Doctest (3/3)}

  To execute all the tests of your module just run:
\+
\begin{lstlisting}[language=sh]
$ python -m doctest mymodule.py
  \end{lstlisting}
%$

  \+
  The \lstinline|-m doctest| option tells python to \textit{execute} the
  \lstinline|doctest| module using your module file as argument.

  \+
  By default it will only show failed tests, so if it does not print
  anything it means that all the tests passed.

  \+
  You can add a \lstinline|-v| option to have a more verbose output
  which includes all the tests executed.



%   \+
%   If you are writing a module and not a script you can also add to it:

%   \begin{lstlisting}
% if __name__ == "__main__":
%     import doctest doctest.testmod()
%   \end{lstlisting}

%   and execute the file with:

%   \begin{lstlisting}[language=sh]
% $ python mymodule.py
%   \end{lstlisting}%$
\end{frame}

\begin{frame}
\+
\begin{exercise}
  The file
  \href{https://raw.github.com/gc3-uzh-ch/python-course/master/vector6.py}{\texttt{vector6.py}}
  has some doctest, but they are wrong. Run the tests, find the errors
  and fix them!
\end{exercise}

\end{frame}


\begin{frame}[fragile]
  \frametitle{The unittest module (1/4)}
  Allows you to create tests in a more structured way using the
  \textit{Template method pattern}.

  \begin{lstlisting}
import unittest

class MyTest(unittest.TestCase):
  def test_square1(self):
    assert square(1) == 1

  def test_square2(self):
    self.assertEqual(square(2), 4)
    self.assertEqual(square(-2), 4)
  \end{lstlisting}

Any method whose name starts with \lstinline|test_| will be run.
A test is successful iff it does \emph{not} raise an exception!

\+
Specialized ``asserts'' are defined in the \lstinline|TestCase|
class: they provide better logging and reporting of failures.
\end{frame}


\begin{frame}[fragile]
  \frametitle{The unittest module (2/4)}

  Each \lstinline|unittest.TestCase| class defines some methods:
  \begin{description}
  \item [\texttt{assertEqual(x,y)}] check that \lstinline|x == y|
  \item[\texttt{assertTrue(x)}] check that \lstinline|x is True|
  \item[\texttt{assertGreater(x, y)}] check that \lstinline|x > y|
  \item[\texttt{assertIsInstance(obj, cls)}] check that
    \lstinline|obj| is an isntance of \lstinline|cls|
  \item[\texttt{assertAlmostEqual(x, y)}]
  \item[\ldots] a lot more, cfr. \lstinline|help(unittest)|
  \end{description}

  \+
\textit{Each one of these method is able to print detailed informations on
  why the test failed, this is why you don't just use
  \texttt{assertTrue()} for all the tests\ldots}
\end{frame}


\begin{frame}[fragile]
  \frametitle{The unittest module (3/4)}
  Supports \textit{fixtures}, code to run before and/or after each
  test to prepare and cleanup the testing environment

  \+
  \begin{lstlisting}
import unittest

class MyTest(unittest.TestCase):
  def setUp(self):
    """This code is run *before* each test method."""

  def tearDown(self):
    """This code is run *after* each test method."""
  \end{lstlisting}
\end{frame}


\begin{frame}[fragile]
\frametitle{The unittest module (4/4)}
Run your tests using
\+
  \begin{lstlisting}[language=sh]
$ python -m unittest -v modulename
test_square (modulename.MyTest) ... ok

--------------------------------------------------
Ran 1 test in 0.000s

OK
\end{lstlisting}
%$

or, if it's a module and not a script, by adding:
\begin{lstlisting}
if __name__ == "__main__":
    unittest.main()
\end{lstlisting}
and executing:

\begin{lstlisting}[language=sh]
$ python modulenae.py
\end{lstlisting}%$

\end{frame}


\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
